From 56c1bc9431c6309d1f55a401347735d17d19cda2 Mon Sep 17 00:00:00 2001
From: Andiry Xu <jix024@cs.ucsd.edu>
Date: Mon, 20 Feb 2017 13:59:34 -0800
Subject: [PATCH 8/8] Add address to dax_cow method

Signed-off-by: Andiry Xu <jix024@cs.ucsd.edu>
---
 arch/x86/mm/fault.c | 2 +-
 include/linux/mm.h  | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.c
index f9b4bac..83cc94f 100644
--- a/arch/x86/mm/fault.c
+++ b/arch/x86/mm/fault.c
@@ -1388,7 +1388,7 @@ __do_page_fault(struct pt_regs *regs, unsigned long error_code,
 		if (vma->original_write && vma->vm_ops &&
 					vma->vm_ops->dax_cow) {
 			up_read(&mm->mmap_sem);
-			vma->vm_ops->dax_cow(vma);
+			vma->vm_ops->dax_cow(vma, address);
 			down_read(&mm->mmap_sem);
 		}
 	}
diff --git a/include/linux/mm.h b/include/linux/mm.h
index 4333f21..ce263d8 100644
--- a/include/linux/mm.h
+++ b/include/linux/mm.h
@@ -390,7 +390,7 @@ struct vm_operations_struct {
 	struct page *(*find_special_page)(struct vm_area_struct *vma,
 					  unsigned long addr);
 	/* For NOVA DAX-mmap protection */
-	int (*dax_cow)(struct vm_area_struct * area);
+	int (*dax_cow)(struct vm_area_struct * area, unsigned long address);
 };
 
 struct mmu_gather;
-- 
2.7.4

